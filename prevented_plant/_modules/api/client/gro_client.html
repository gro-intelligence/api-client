

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>api.client.gro_client &mdash; Gro API Client  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/custom-theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/banner.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Gro API Client
          

          
            
            <img src="../../../_static/logo.jpg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../setting-up-your-environment.html">Setting Up Your Environment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../setting-up-your-environment.html#system-prerequisites">System Prerequisites</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../setting-up-your-environment.html#macos-and-linux">MacOS and Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../setting-up-your-environment.html#windows">Windows</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../setting-up-your-environment.html#anaconda">Anaconda</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../setting-up-your-environment.html#non-anaconda">Non-Anaconda</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../setting-up-your-environment.html#installing-gro-packages">Installing Gro Packages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../setting-up-your-environment.html#authentication-token">Authentication Token</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../setting-up-your-environment.html#retrieving-a-token">Retrieving a token</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../setting-up-your-environment.html#option-1-using-the-web-app-recommended">Option 1: Using the Web App (Recommended)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../setting-up-your-environment.html#option-2-using-the-gro-client-command-line-interface">Option 2: Using the gro_client Command Line Interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../setting-up-your-environment.html#option-3-using-the-get-access-token-function">Option 3: Using the <code class="docutils literal"><span class="pre">get_access_token()</span></code> Function</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../setting-up-your-environment.html#expiring-regenerating-tokens">Expiring/Regenerating Tokens</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../setting-up-your-environment.html#saving-your-token-as-an-environment-variable">Saving your token as an environment variable</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../setting-up-your-environment.html#for-windows-10">For Windows 10:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../setting-up-your-environment.html#for-mac">For Mac:</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started.html#discovering-data">Discovering Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started.html#code-snippets">Code snippets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started.html#search">Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started.html#get-data-series">Get data series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started.html#lookup-contains">Lookup contains</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started.html#get-descendants">Get descendants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started.html#lookup-belongs">Lookup belongs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started.html#retrieving-data">Retrieving Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started.html#get-data-points">Get data points</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started.html#data-frame">Data frame</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started.html#show-revisions">Show revisions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started.html#understanding-data-responses">Understanding Data Responses</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../getting-started.html#look-up">Look up</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../gro-data-key-concepts.html">Gro Data Key Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../gro-data-key-concepts.html#gro-ontology">Gro Ontology</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../gro-data-key-concepts.html#entity-fields">Entity fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../gro-data-key-concepts.html#entity-relationships-contains">Entity Relationships: Contains</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../gro-data-key-concepts.html#special-properties-for-regions">Special Properties for Regions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../gro-data-key-concepts.html#level"><code class="docutils literal"><span class="pre">level</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../gro-data-key-concepts.html#latitude-and-longitude"><code class="docutils literal"><span class="pre">latitude</span></code> and <code class="docutils literal"><span class="pre">longitude</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../gro-data-key-concepts.html#data-series-definition">Data Series Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gro-data-key-concepts.html#data-point-definition">Data Point Definition</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api.html#module-api.client.lib">lib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api.html#client">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api.html#groclient">GroClient</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api.html#crop-model">Crop Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api.html#batch-client">Batch Client</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq.html">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../faq.html#exploring-what-s-available">Exploring What&#8216;s Available</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../faq.html#q-why-is-it-that-when-i-use-client-search-to-find-metrics-items-regions-i-m-interested-in-sometimes-client-get-data-series-doesn-t-have-any-data-for-those-metrics-items-regions">Q: Why is it that when I use client.search() to find metrics/items/regions I&#8216;m interested in, sometimes client.get_data_series() doesn&#8216;t have any data for those metrics/items/regions?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../faq.html#q-what-does-sourcelag-mean-when-i-use-client-lookup-to-inspect-a-source-s-details">Q: What does &#8216;sourceLag&#8216; mean when I use client.lookup() to inspect a source&#8216;s details?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../faq.html#data-retrieval">Data Retrieval</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../faq.html#q-i-specified-an-end-date-when-calling-get-data-points-but-i-am-getting-points-with-other-end-dates">Q: I specified an end_date when calling get_data_points(), but I am getting points with other end_dates:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../faq.html#account">Account</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../faq.html#q-i-tried-using-my-gro-username-and-login-but-am-getting-a-401-unauthorized-error">Q: I tried using my Gro username and login but am getting a 401 Unauthorized error</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../faq.html#gro-models">Gro Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../faq.html#q-do-your-predictive-models-only-run-during-the-crop-season">Q: Do your predictive models only run during the crop season?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../other.html">Other</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../other.html#gro-crop-masks">Gro Crop Masks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../other.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../other.html#methodology">Methodology</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../other.html#us-corn">US Corn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../other.html#us-soy">US Soy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../other.html#argentina-soy">Argentina Soy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../other.html#india-wheat">India Wheat</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../other.html#gro-yield-model-backtest-data">Gro Yield Model Backtest Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../other.html#id1">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../other.html#file-formats">File Formats</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../other.html#download-the-data-by-model">Download the Data by Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../other.html#radio-frequency-interference-effects-on-smos">Radio Frequency Interference Effects On SMOS</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Gro API Client</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../client.html">api.client</a> &raquo;</li>
        
      <li>api.client.gro_client</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  


    
    



    <p class="scv-banner scv-sphinx_rtd_theme"><b>Warning:</b> This document is for the development version of Gro API Client.</p>
<h1>Source code for api.client.gro_client</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">zip</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">str</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">unicodecsv</span>
<span class="kn">from</span> <span class="nn">api.client</span> <span class="kn">import</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">lib</span><span class="p">,</span> <span class="n">Client</span>


<span class="n">API_HOST</span> <span class="o">=</span> <span class="s1">&#39;api.gro-intelligence.com&#39;</span>
<span class="n">OUTPUT_FILENAME</span> <span class="o">=</span> <span class="s1">&#39;gro_client_output.csv&#39;</span>

<span class="n">DATA_POINTS_UNIQUE_COLS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;item_id&#39;</span><span class="p">,</span> <span class="s1">&#39;metric_id&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;region_id&#39;</span><span class="p">,</span> <span class="s1">&#39;partner_region_id&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;frequency_id&#39;</span><span class="p">,</span> <span class="s1">&#39;source_id&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;reporting_date&#39;</span><span class="p">,</span> <span class="s1">&#39;start_date&#39;</span><span class="p">,</span> <span class="s1">&#39;end_date&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="GroClient"><a class="viewcode-back" href="../../../api.html#api.client.gro_client.GroClient">[docs]</a><span class="k">class</span> <span class="nc">GroClient</span><span class="p">(</span><span class="n">Client</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An extension of the Client class with extra convenience methods for some common operations.</span>

<span class="sd">    Extra functionality includes:</span>
<span class="sd">    - Automatic conversion of units</span>
<span class="sd">    - Finding data series using entity names rather than ids</span>
<span class="sd">    - Exploration shortcuts for filling in partial selections</span>
<span class="sd">    - Saving data series in a data frame for repeated use</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_host</span><span class="p">,</span> <span class="n">access_token</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GroClient</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">api_host</span><span class="p">,</span> <span class="n">access_token</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">get_default_logger</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_series_list</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># all that have been added</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_series_queue</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># added but not loaded in data frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_frame</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span>

    <span class="c1">###</span>
    <span class="c1"># Finding, indexing and loading multiple data series into a data frame</span>
    <span class="c1">###</span>
<div class="viewcode-block" id="GroClient.get_df"><a class="viewcode-back" href="../../../api.html#api.client.gro_client.GroClient.get_df">[docs]</a>    <span class="k">def</span> <span class="nf">get_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the content of all data series in a Pandas frame.&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_series_queue</span><span class="p">:</span>
            <span class="n">data_series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_series_queue</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_points</span><span class="p">(</span><span class="o">**</span><span class="n">data_series</span><span class="p">))</span>
            <span class="c1"># get_data_points response doesn&#39;t include the</span>
            <span class="c1"># source_id. We add it as a column, in case we have</span>
            <span class="c1"># several selections series which differ only by source id.</span>
            <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;source_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_series</span><span class="p">[</span><span class="s1">&#39;source_id&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;end_date&#39;</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">tmp</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;start_date&#39;</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">tmp</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;reporting_date&#39;</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">tmp</span><span class="o">.</span><span class="n">reporting_date</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">reporting_date</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data_frame</span> <span class="o">=</span> <span class="n">tmp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data_frame</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">DATA_POINTS_UNIQUE_COLS</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_frame</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_frame</span></div>

<div class="viewcode-block" id="GroClient.get_data_points"><a class="viewcode-back" href="../../../api.html#api.client.gro_client.GroClient.get_data_points">[docs]</a>    <span class="k">def</span> <span class="nf">get_data_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">selections</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extend the Client&#39;s get_data_points method to add unit conversion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        selections : dict</span>
<span class="sd">            See lib.py get_data_points() for the base list of inputs</span>
<span class="sd">            This extended version may additionally include &#39;unit_id&#39; which is</span>
<span class="sd">            the unit you wish to convert all points to.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of dicts</span>
<span class="sd">            Unchanged output format from lib.py get_data_points()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_points</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">GroClient</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_data_points</span><span class="p">(</span><span class="o">**</span><span class="n">selections</span><span class="p">)</span>
        <span class="c1"># Apply unit conversion if a unit is specified</span>
        <span class="k">if</span> <span class="s1">&#39;unit_id&#39;</span> <span class="ow">in</span> <span class="n">selections</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_unit</span><span class="p">,</span> <span class="n">target_unit_id</span><span class="o">=</span><span class="n">selections</span><span class="p">[</span><span class="s1">&#39;unit_id&#39;</span><span class="p">]),</span> <span class="n">data_points</span><span class="p">))</span>
        <span class="c1"># Return data points in input units if not unit is specified</span>
        <span class="k">return</span> <span class="n">data_points</span></div>

    <span class="k">def</span> <span class="nf">get_data_series_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_series_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_single_data_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_series</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_series_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_series</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_series_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_series</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Added </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_series</span><span class="p">))</span>
        <span class="k">return</span>

<div class="viewcode-block" id="GroClient.find_data_series"><a class="viewcode-back" href="../../../api.html#api.client.gro_client.GroClient.find_data_series">[docs]</a>    <span class="k">def</span> <span class="nf">find_data_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Search for entities matching the given names, find data series for</span>
<span class="sd">        the given combination.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">           A data series, same output format as lib.py get_data_series().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">search_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">):</span>
            <span class="n">search_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">])[:</span><span class="n">cfg</span><span class="o">.</span><span class="n">MAX_RESULT_COMBINATION_DEPTH</span><span class="p">])</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;item_id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;metric&#39;</span><span class="p">):</span>
            <span class="n">search_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;metrics&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">])[:</span><span class="n">cfg</span><span class="o">.</span><span class="n">MAX_RESULT_COMBINATION_DEPTH</span><span class="p">])</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;metric_id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">):</span>
            <span class="n">search_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;regions&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])[:</span><span class="n">cfg</span><span class="o">.</span><span class="n">MAX_RESULT_COMBINATION_DEPTH</span><span class="p">])</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;region_id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;partner_region&#39;</span><span class="p">):</span>
            <span class="n">search_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;regions&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;partner_region&#39;</span><span class="p">])[:</span><span class="n">cfg</span><span class="o">.</span><span class="n">MAX_RESULT_COMBINATION_DEPTH</span><span class="p">])</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;partner_region_id&#39;</span><span class="p">)</span>
        <span class="n">all_data_series</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">comb</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">search_results</span><span class="p">):</span>
            <span class="n">entities</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="p">[</span><span class="n">entity</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">comb</span><span class="p">])))</span>
            <span class="n">data_series_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_series</span><span class="p">(</span><span class="o">**</span><span class="n">entities</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">{}</span><span class="s2"> distinct data series for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">data_series_list</span><span class="p">),</span> <span class="n">entities</span><span class="p">))</span>
            <span class="c1"># temporal coverage affects ranking so add time range if specified.</span>
            <span class="k">for</span> <span class="n">data_series</span> <span class="ow">in</span> <span class="n">data_series_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;start_date&#39;</span><span class="p">):</span>
                    <span class="n">data_series</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;end_date&#39;</span><span class="p">):</span>
                    <span class="n">data_series</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]</span>
            <span class="n">all_data_series</span> <span class="o">+=</span> <span class="n">data_series_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">{}</span><span class="s2"> distinct data series total for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">all_data_series</span><span class="p">),</span> <span class="n">kwargs</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">data_series</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank_series_by_source</span><span class="p">(</span><span class="n">all_data_series</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">data_series</span></div>

<div class="viewcode-block" id="GroClient.add_data_series"><a class="viewcode-back" href="../../../api.html#api.client.gro_client.GroClient.add_data_series">[docs]</a>    <span class="k">def</span> <span class="nf">add_data_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Search for entities matching the given names, find data series for</span>
<span class="sd">        the given combination, and add them to this objects list of</span>
<span class="sd">        series.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">the_data_series</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_data_series</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_single_data_series</span><span class="p">(</span><span class="n">the_data_series</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">return</span></div>

    <span class="c1">###</span>
    <span class="c1"># Discovery shortcuts</span>
    <span class="c1">###</span>
<div class="viewcode-block" id="GroClient.search_for_entity"><a class="viewcode-back" href="../../../api.html#api.client.gro_client.GroClient.search_for_entity">[docs]</a>    <span class="k">def</span> <span class="nf">search_for_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">keywords</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the first result of entity_type (which is items, metrics or</span>
<span class="sd">        regions) that matches the given keywords.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">keywords</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;First result, out of </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">),</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">get_provinces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">country_name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_and_lookup</span><span class="p">(</span><span class="s1">&#39;regions&#39;</span><span class="p">,</span> <span class="n">country_name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">region</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">lib</span><span class="o">.</span><span class="n">REGION_LEVELS</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]:</span>
                <span class="n">provinces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_descendant_regions</span><span class="p">(</span><span class="n">region</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">lib</span><span class="o">.</span><span class="n">REGION_LEVELS</span><span class="p">[</span><span class="s1">&#39;province&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Provinces of </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">country_name</span><span class="p">,</span> <span class="n">provinces</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">provinces</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1">###</span>
    <span class="c1"># Convenience methods that automatically fill in partial selections with random entities</span>
    <span class="c1">###</span>
<div class="viewcode-block" id="GroClient.pick_random_entities"><a class="viewcode-back" href="../../../api.html#api.client.gro_client.GroClient.pick_random_entities">[docs]</a>    <span class="k">def</span> <span class="nf">pick_random_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pick a random item that has some data associated with it, and a</span>
<span class="sd">        random metric and region pair for that item with data</span>
<span class="sd">        available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_available</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">)</span>
        <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">num</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">item_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">item_list</span><span class="p">)</span><span class="o">*</span><span class="n">random</span><span class="p">())]</span>
            <span class="n">selected_entities</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;itemId&#39;</span><span class="p">:</span>  <span class="n">item</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]}</span>
            <span class="n">entity_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_available</span><span class="p">(</span><span class="n">selected_entities</span><span class="p">)</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">entity_list</span><span class="p">)</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="n">entity_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="o">*</span><span class="n">random</span><span class="p">())]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using randomly selected entities: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entities</span><span class="p">)))</span>
        <span class="n">selected_entities</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">selected_entities</span></div>

<div class="viewcode-block" id="GroClient.pick_random_data_series"><a class="viewcode-back" href="../../../api.html#api.client.gro_client.GroClient.pick_random_data_series">[docs]</a>    <span class="k">def</span> <span class="nf">pick_random_data_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected_entities</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a selection of tentities, pick a random available data series</span>
<span class="sd">        the given selection of entities.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_series_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_series</span><span class="p">(</span><span class="o">**</span><span class="n">selected_entities</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data_series_list</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No data series available for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">selected_entities</span><span class="p">))</span>
        <span class="n">selected_data_series</span> <span class="o">=</span> <span class="n">data_series_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_series_list</span><span class="p">)</span><span class="o">*</span><span class="n">random</span><span class="p">())]</span>
        <span class="k">return</span> <span class="n">selected_data_series</span></div>

    <span class="c1"># TODO: rename function to &quot;write_...&quot; rather than &quot;print_...&quot;</span>
<div class="viewcode-block" id="GroClient.print_one_data_series"><a class="viewcode-back" href="../../../api.html#api.client.gro_client.GroClient.print_one_data_series">[docs]</a>    <span class="k">def</span> <span class="nf">print_one_data_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_series</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Output a data series to a CSV file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using data series: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data_series</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Outputing to file: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">unicodecsv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_points</span><span class="p">(</span><span class="o">**</span><span class="n">data_series</span><span class="p">):</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">point</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">],</span>
                             <span class="n">point</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">point</span><span class="p">[</span><span class="s1">&#39;input_unit_scale&#39;</span><span class="p">],</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">lookup_unit_abbreviation</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="s1">&#39;input_unit_id&#39;</span><span class="p">])])</span></div>

<div class="viewcode-block" id="GroClient.convert_unit"><a class="viewcode-back" href="../../../api.html#api.client.gro_client.GroClient.convert_unit">[docs]</a>    <span class="k">def</span> <span class="nf">convert_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">target_unit_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert the data point from one unit to another unit.</span>

<span class="sd">        If original or target unit is non-convertible, throw an error.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        point : dict</span>
<span class="sd">            { value: float, unit_id: integer, ... }</span>
<span class="sd">        target_unit_id : integer</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            { value: float, unit_id: integer, ... }</span>
<span class="sd">            unit_id is changed to the target, and value is converted to use the</span>
<span class="sd">            new unit_id. Other properties are unchanged.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unit_id&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">point</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unit_id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">target_unit_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">point</span>
        <span class="n">from_convert_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span>
            <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="n">point</span><span class="p">[</span><span class="s1">&#39;unit_id&#39;</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;baseConvFactor&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">from_convert_factor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;factor&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;unit_id </span><span class="si">{}</span><span class="s1"> is not convertible&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="s1">&#39;unit_id&#39;</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="n">to_convert_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span>
            <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="n">target_unit_id</span>
        <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;baseConvFactor&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">to_convert_factor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;factor&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;unit_id </span><span class="si">{}</span><span class="s1"> is not convertible&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_unit_id</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_in_base_unit</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">point</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">from_convert_factor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;factor&#39;</span><span class="p">)</span>
            <span class="p">)</span> <span class="o">+</span> <span class="n">from_convert_factor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">point</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                <span class="n">value_in_base_unit</span> <span class="o">-</span> <span class="n">to_convert_factor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">)</span> <span class="o">/</span> <span class="n">to_convert_factor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;factor&#39;</span><span class="p">)</span>
        <span class="n">point</span><span class="p">[</span><span class="s1">&#39;unit_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_unit_id</span>
        <span class="k">return</span> <span class="n">point</span></div></div>


<span class="sd">&quot;&quot;&quot;Basic Gro API command line interface.</span>

<span class="sd">Note that results are chosen randomly from matching selections, and so results are not deterministic. This tool is useful for simple queries, but anything more complex should be done using the provided Python packages.</span>

<span class="sd">Usage examples:</span>
<span class="sd">    gro_client --item=soybeans  --region=brazil --partner_region china --metric export</span>
<span class="sd">    gro_client --item=sesame --region=ethiopia</span>
<span class="sd">    gro_client --user_email=john.doe@example.com  --print_token</span>
<span class="sd">For more information use --help</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Gro API command line interface&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--user_email&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--user_password&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--item&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--metric&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--region&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--partner_region&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--print_token&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Ouput API access token for the given user email and password. &quot;</span>
                        <span class="s2">&quot;Save it in GROAPI_TOKEN environment variable.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--token&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GROAPI_TOKEN&#39;</span><span class="p">),</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Defaults to GROAPI_TOKEN environment variable.&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">args</span><span class="o">.</span><span class="n">user_email</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="s2">&quot;Need --token, or --user_email, or $GROAPI_TOKEN&quot;</span>
    <span class="n">access_token</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">token</span><span class="p">:</span>
        <span class="n">access_token</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">token</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">user_password</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">user_password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">()</span>
        <span class="n">access_token</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">get_access_token</span><span class="p">(</span><span class="n">API_HOST</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">user_email</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">user_password</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">print_token</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">access_token</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">GroClient</span><span class="p">(</span><span class="n">API_HOST</span><span class="p">,</span> <span class="n">access_token</span><span class="p">)</span>

    <span class="n">selected_entities</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">item</span><span class="p">:</span>
        <span class="n">selected_entities</span><span class="p">[</span><span class="s1">&#39;item_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">search_for_entity</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">metric</span><span class="p">:</span>
        <span class="n">selected_entities</span><span class="p">[</span><span class="s1">&#39;metric_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">search_for_entity</span><span class="p">(</span><span class="s1">&#39;metrics&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">metric</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">region</span><span class="p">:</span>
        <span class="n">selected_entities</span><span class="p">[</span><span class="s1">&#39;region_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">search_for_entity</span><span class="p">(</span><span class="s1">&#39;regions&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">region</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">partner_region</span><span class="p">:</span>
        <span class="n">selected_entities</span><span class="p">[</span><span class="s1">&#39;partner_region_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">search_for_entity</span><span class="p">(</span><span class="s1">&#39;regions&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">partner_region</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">selected_entities</span><span class="p">:</span>
        <span class="n">selected_entities</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">pick_random_entities</span><span class="p">()</span>

    <span class="n">data_series</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">pick_random_data_series</span><span class="p">(</span><span class="n">selected_entities</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data series example:&quot;</span><span class="p">)</span>
    <span class="n">client</span><span class="o">.</span><span class="n">print_one_data_series</span><span class="p">(</span><span class="n">data_series</span><span class="p">,</span> <span class="n">OUTPUT_FILENAME</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_df</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="o">**</span><span class="n">selected_entities</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Deprecated: use the corresponding method in GroClient instead.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">get_data_points</span><span class="p">(</span><span class="o">**</span><span class="n">selected_entities</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">search_for_entity</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">keywords</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Deprecated: use the corresponding method in GroClient instead.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">search_for_entity</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">keywords</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">pick_random_entities</span><span class="p">(</span><span class="n">client</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Deprecated: use the corresponding method in GroClient instead.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">pick_random_entities</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">print_random_data_series</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">selected_entities</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Example which prints out a CSV of a random data series that</span>
<span class="sd">    satisfies the (optional) given selection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">print_one_data_series</span><span class="p">(</span>
        <span class="n">client</span><span class="o">.</span><span class="n">pick_random_data_series</span><span class="p">(</span><span class="n">selected_entities</span><span class="p">),</span>
        <span class="n">OUTPUT_FILENAME</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Gro Intelligence

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: prevented_plant
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../../../../v1.40.6/index.html">v1.40.6</a></dd>
            <dd><a href="../../../../v1.56.0/index.html">v1.56.0</a></dd>
            <dd><a href="../../../../v1.56.1/index.html">v1.56.1</a></dd>
            <dd><a href="../../../../v1.56.2/index.html">v1.56.2</a></dd>
            <dd><a href="../../../../v1.60.0/index.html">v1.60.0</a></dd>
            <dd><a href="../../../../v1.60.1/index.html">v1.60.1</a></dd>
            <dd><a href="../../../../v1.71.0/index.html">v1.71.0</a></dd>
            <dd><a href="../../../../v1.76.0/index.html">v1.76.0</a></dd>
            <dd><a href="../../../../v1.77.0/index.html">v1.77.0</a></dd>
            <dd><a href="../../../../v1.77.1/index.html">v1.77.1</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../../CLEWS-15762/index.html">CLEWS-15762</a></dd>
            <dd><a href="../../../../CLEWS-15766/index.html">CLEWS-15766</a></dd>
            <dd><a href="../../../../CLEWS-16955-units/index.html">CLEWS-16955-units</a></dd>
            <dd><a href="../../../../CLEWS-17015/index.html">CLEWS-17015</a></dd>
            <dd><a href="../../../../CLEWS-19063/index.html">CLEWS-19063</a></dd>
            <dd><a href="../../../../CLEWS-19840/index.html">CLEWS-19840</a></dd>
            <dd><a href="../../../../CLEWS-19840-3/index.html">CLEWS-19840-3</a></dd>
            <dd><a href="../../../../CLEWS-22288/index.html">CLEWS-22288</a></dd>
            <dd><a href="../../../../CLEWS-23237_revision_get_df/index.html">CLEWS-23237_revision_get_df</a></dd>
            <dd><a href="../../../../CLEWS-23863/index.html">CLEWS-23863</a></dd>
            <dd><a href="../../../../CLEWS-25132/index.html">CLEWS-25132</a></dd>
            <dd><a href="../../../../CLEWS-25139-2/index.html">CLEWS-25139-2</a></dd>
            <dd><a href="../../../../CLEWS-25139-revert/index.html">CLEWS-25139-revert</a></dd>
            <dd><a href="../../../../CLEWS-25726/index.html">CLEWS-25726</a></dd>
            <dd><a href="../../../../CLEWS-26758-similar_regions/index.html">CLEWS-26758-similar_regions</a></dd>
            <dd><a href="../../../../CLEWS-27163/index.html">CLEWS-27163</a></dd>
            <dd><a href="../../../../CLEWS-27625-fixtures/index.html">CLEWS-27625-fixtures</a></dd>
            <dd><a href="../../../../CLEWS-4539/index.html">CLEWS-4539</a></dd>
            <dd><a href="../../../../analogous_years_modifications/index.html">analogous_years_modifications</a></dd>
            <dd><a href="../../../../black/index.html">black</a></dd>
            <dd><a href="../../../../brazil_soybeans_update/index.html">brazil_soybeans_update</a></dd>
            <dd><a href="../../../../development/index.html">development</a></dd>
            <dd><a href="../../../../docs-content-changes/index.html">docs-content-changes</a></dd>
            <dd><a href="../../../../docs-latest-tag/index.html">docs-latest-tag</a></dd>
            <dd><a href="../../../../eliaschneider-patch-1/index.html">eliaschneider-patch-1</a></dd>
            <dd><a href="../../../../fix-docs-links/index.html">fix-docs-links</a></dd>
            <dd><a href="../../../../get_region_id_given_lat_lon/index.html">get_region_id_given_lat_lon</a></dd>
            <dd><a href="../../../../nemo/index.html">nemo</a></dd>
            <dd><a href="../../../../nemozen-path-1/index.html">nemozen-path-1</a></dd>
            <dd><a href="gro_client.html">prevented_plant</a></dd>
            <dd><a href="../../../../revert-210-CLEWS-25139-py2/index.html">revert-210-CLEWS-25139-py2</a></dd>
            <dd><a href="../../../../simplify-quickstart/index.html">simplify-quickstart</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>